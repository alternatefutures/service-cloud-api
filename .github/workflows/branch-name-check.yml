name: Branch Name Check
permissions:
  contents: read

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  check-branch-name:
    name: Validate Branch Name
    runs-on: ubuntu-latest

    steps:
      - name: Check branch name
        run: |
          BRANCH_NAME="${{ github.head_ref }}"
          echo "Checking branch name: $BRANCH_NAME"

          # Valid patterns (ticket number optional):
          # - feature/description or feat/description
          # - fix/description
          # - hotfix/description
          # - chore/description
          # - docs/description
          # - refactor/description

          if [[ "$BRANCH_NAME" =~ ^(feature|feat|fix|hotfix|chore|docs|refactor)/[a-z0-9-]+$ ]]; then
            echo "✅ Branch name is valid: $BRANCH_NAME"
            exit 0
          else
            echo "❌ Invalid branch name: $BRANCH_NAME"
            echo ""
            echo "Branch names must follow this format:"
            echo "  - feature/description or feat/description"
            echo "  - fix/description"
            echo "  - hotfix/description"
            echo "  - chore/description"
            echo "  - docs/description"
            echo "  - refactor/description"
            echo ""
            echo "Where description uses lowercase letters, numbers, and hyphens"
            echo ""
            echo "Examples:"
            echo "  ✅ feature/add-webhook-support"
            echo "  ✅ feat/user-auth"
            echo "  ✅ fix/auth-token-expiry"
            echo "  ✅ hotfix/security-patch"
            echo "  ✅ chore/update-dependencies"
            echo "  ❌ my-feature (missing prefix)"
            echo "  ❌ Feature/Something (uppercase not allowed)"
            exit 1
          fi

  check-pr-title:
    name: Validate PR Title
    runs-on: ubuntu-latest

    steps:
      - name: Check PR title format
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"
          echo "Checking PR title: $PR_TITLE"

          # PR title should follow conventional commit format
          # Format: type: description or type(scope): description

          if [[ "$PR_TITLE" =~ ^(feat|fix|docs|style|refactor|perf|test|chore|ci|build|revert)(\(.+\))?:\ .+ ]]; then
            echo "✅ PR title follows conventional commit format"
            exit 0
          else
            echo "⚠️  PR title doesn't follow conventional commit format (non-blocking)"
            echo ""
            echo "Recommended formats:"
            echo "  - feat: Add webhook support"
            echo "  - fix: Auth token expiry issue"
            echo "  - fix(auth): Token refresh bug"
            echo "  - docs: Update README"
            echo "  - chore: Update dependencies"
            echo ""
            echo "Current title: $PR_TITLE"
            # Non-blocking - just a warning
            exit 0
          fi
